<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Void Ascendant: Stage 1 â€“ Survival</title>
  <link rel="stylesheet" href="style.css">
  <script defer src="game.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cloud.umami.is/script.js" data-website-id="a5575ef9-727c-4d11-a992-cc853e89e46e"></script>
</head>
<body>
<div id="game" x-data="game()" x-init="initAlpine()">

  <!-- Intro Video Overlay -->
  <template x-if="showIntroVideo">
    <div class="intro-video-overlay">
      <video
        src="media/splash.mp4"
        class="intro-video"
        autoplay
        muted
        playsinline
        @ended="showIntroVideo = false; showSplash = true"
        @click="showIntroVideo = false; showSplash = true"
        tabindex="0"
      ></video>
      <div class="intro-skip-overlay">
        <div class="intro-skip" @click="showIntroVideo = false; showSplash = true">Skip</div>
      </div>
    </div>
  </template>

  <!-- Debug Win/Loss Buttons (hidden) -->
  <div x-show="false" class="debug-btn-bar">
    <button
      class="debug-btn debug-btn-green"
      @click="stageComplete = true; finishShown = true"
      title="Show Congratulations overlay (debug)">
      Show Win
    </button>
    <button
      class="debug-btn debug-btn-red"
      @click="gameOver = true; finishShown = true; gameOverReason = 'Debug: Forced Loss'; stageComplete = false"
      title="Show Game Over overlay (debug)">
      Show Loss
    </button>
    <button
      class="debug-btn debug-btn-blue"
      @click="localStorage.removeItem('voidascendant_intro_shown'); location.reload()"
      title="Reset intro video flag and reload">
      Reset
    </button>
    <button
      class="debug-btn debug-btn-orange"
      @click="paused = !paused"
      :title="paused ? 'Resume game timers' : 'Pause game timers'"
      x-text="paused ? 'Resume' : 'Pause'"
    ></button>
    <button
      class="debug-btn debug-btn-cyan"
      @click="log('A faint signal pulses into the sky... will anyone hear it?')"
      title="Trigger Emergency Beacon log message (debug)">
      Signal Log
    </button>
  </div>

  <!-- Splash Screen -->
  <template x-if="showSplash">
    <div class="splash-overlay">
      <div class="splash-panel">
        <h2>Void Ascendant</h2>
        <p style="margin: 1.5em 0 2em 0;">You wake in the shattered remains of an escape pod. Gather resources to survive.</p>
        <button @click="startGame()" class="try-again-btn">Begin</button>
      </div>
    </div>
  </template>

  <!-- Log -->
  <section>
    <h2>ARIA</h2>
    <div id="messages" x-ref="messages">
      <template x-for="(msg, index) in logMessages" :key="index">
        <div :class="msg.cls" x-text="msg.text"></div>
      </template>
      <template x-if="gameOver">
        <div style="margin-top: 1em; text-align: center;">
          <button @click="location.reload()" class="try-again-btn">Try again</button>
        </div>
      </template>
    </div>
  </section>

  <!-- Resources -->
  <section style="display: flex; justify-content: space-between; align-items: flex-start;">
    <div>
      <h2>Resources</h2>
      <ul>
        <li>
          <img src="media/energy.png" alt="Energy" class="icon-inline"> Energy:
          <span :class="{'danger': energy <= 5}" x-text="Math.floor(energy)"></span>/<span x-text="energyCap"></span>
        </li>
        <li>
          <img src="media/minerals.png" alt="Minerals" class="icon-inline"> Minerals:
          <span x-text="Math.floor(minerals)"></span>
        </li>
        <li>
          <img src="media/organics.png" alt="Organics" class="icon-inline"> Organics:
          <span :class="{'danger': organics <= 2}" x-text="Math.floor(organics)"></span>
        </li>
      </ul>
    </div>
    <div style="text-align: right; min-width: 80px;">
      <h2>Days</h2>
      <div class="days" x-text="days"></div>
    </div>
  </section>

  <!-- Actions -->
  <section id="actions" style="display: flex; justify-content: space-between; gap: 2em; align-items: flex-start;">
    <div style="flex: 1; text-align: center;">
      <div style="font-weight: bold; margin-bottom: 0.3em; color: #0f0;">Generate</div>
      <button @click="gather('energy')" :disabled="energy >= energyCap || gameOver" style="display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto;">
        <img src="media/energy.png" alt="Energy" class="icon-inline" style="font-size: 2em; margin-bottom: 0.2em;">
      </button>
      <div style="font-size: 0.9em; margin-top: 0.1em; color: #0f0;">+1</div>
    </div>
    <div style="flex: 1; text-align: center;">
      <div style="font-weight: bold; margin-bottom: 0.3em; color: #0f0;">Gather</div>
      <div style="display: flex; flex-direction: row; justify-content: center; gap: 0.7em;">
        <div style="display: flex; flex-direction: column; align-items: center;">
          <button @click="gather('minerals')" :disabled="gameOver" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <img src="media/minerals.png" alt="Minerals" class="icon-inline" style="font-size: 2em; margin-bottom: 0.2em;">
          </button>
          <div style="font-size: 0.9em; margin-top: 0.1em; color: #0f0;">+<span x-text="gatherMinerals"></span></div>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center;">
          <button @click="gather('organics')" :disabled="gameOver" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <img src="media/organics.png" alt="Organics" class="icon-inline" style="font-size: 2em; margin-bottom: 0.2em;">
          </button>
          <div style="font-size: 0.9em; margin-top: 0.1em; color: #3c3;">+<span x-text="gatherOrganics"></span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Crafting -->
  <section>
    <h2>Craft</h2>
    <template x-for="craft in crafts" :key="craft.id">
      <div class="craft" x-show="!items[craft.id] && hasPrereq(craft)">
        <button :disabled="!canAfford(craft.cost) || gameOver" @click="craftItem(craft)" x-text="craft.name"></button>
        <span x-text="' Cost: ' + Object.entries(craft.cost).map(([k,v]) => `${v} ${k}`).join(', ')"></span>
      </div>
    </template>
  </section>

  <!-- Win Overlay -->
  <template x-if="stageComplete && finishShown">
    <div class="game-over-overlay">
      <div class="game-over-panel">
        <h2>Congratulations!</h2>
        <p>You survived the wilds and laid the foundations for a future colony!</p>
        <div class="win-score">Days Survived: <span x-text="days"></span></div>
        <button @click="location.reload()" class="try-again-btn">Try again</button>
      </div>
    </div>
  </template>

  <!-- Game Over Overlay -->
  <template x-if="gameOver && finishShown && !stageComplete">
    <div class="game-over-overlay">
      <div class="game-over-panel">
        <h2>Game Over</h2>
        <p x-text="gameOverReason" style="color: #f33; font-weight: bold;"></p>
        <div class="win-score">Days Survived: <span x-text="days"></span></div>
        <button @click="location.reload()" class="try-again-btn">Try again</button>
      </div>
    </div>
  </template>

</div>
</body>
</html>
